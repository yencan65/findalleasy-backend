app.post("/api/register", async (req, res) => {
  const { email, password } = req.body;
  const exists = await db.collection("users").findOne({ email });
  if (exists) return res.json({ ok: false, msg: "Zaten kay覺tl覺s覺n覺z." });

  const hash = await bcrypt.hash(password, 10);
  const user = {
    email,
    passwordHash: hash,
    referralCode: shortid.generate(),
    commissionDiscount: 0.0,
    createdAt: new Date(),
  };
  const result = await db.collection("users").insertOne(user);
  res.json({ ok: true, user: result.ops[0] });
});
